---

- name: Bootstrap personal Linux PC
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    packages:
      - neovim>=0.9
      - npm
      - tmux
      - fish
      - fisher
      - ripgrep
      - lazygit

  tasks:
    - name: Prepare | Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ ansible_user_id }}"

    - name: Install (system-wide) | Packages
      ansible.builtin.package:
        name: "{{ item }}"
        state: present
      become: true
      loop: "{{ packages }}"
      register: pkg_state

    - name: Install (personal) | Neovim if not packaged
      ansible.builtin.get_url:
        url: https://github.com/neovim/neovim/releases/latest/download/nvim-linux64.tar.gz
        dest: /tmp
      when: not pkg_state

        #  - name: Install | JetBrains Mono Nerd font
        #  Only if terminal is running in host OS
    - name: Install (personal) | tmux package manager
      ansible.builtin.git:
        repo: https://github.com/tmux-plugins/tpm
        dest: ~/.tmux/plugins/tpm

    - name: Install (personal) | fish tide plugin
      ansible.builtin.command: fish -c "fisher install ilancosman/tide@v5"

    - name: Config | Change shell to fish
      ansible.builtin.user:
        name: "{{ remote_regular_user }}"
        shell: /usr/bin/fish
      become: true
